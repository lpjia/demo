// äº‘ç¬”è®°ä¸Šæœ‰æˆªå›¾, åŒæ—¶å¯¹ç…§ç€çœ‹æ–¹ä¾¿ç†è§£

const str = 'å‰å¨ƒå¨ƒä¸æ˜¯ð ®·å¨ƒå¨ƒðŸ˜‚æ˜¯ä¸æ˜¯çœ¼èŠ±äº†'
// æƒ³è¦å–å‡º   å¨ƒå¨ƒðŸ˜‚

// å¸¸è§„æ€è·¯è‚¯å®šè¿™æ ·å–
console.log(
  str.substring(6, 9)
  // ä¸æ»¡è¶³é¢„æœŸç»“æžœ, æœ‰ä¹±ç 
)
console.log(
  'ð ®·'.length,
  'ðŸ˜‚'.length, // å ä¸¤ä¸ªç å…ƒ
  'çœ¼'.length // æ™®é€šå­—ç¬¦å ä¸€ä¸ªç å…ƒ
)
console.log(
  'ðŸ˜‚'[0], // ä¹±ç 
  'ðŸ˜‚'[1], // ä¹±ç 
)

/* å­—ç¬¦ç¼–ç é—®é¢˜
16ä½äºŒè¿›åˆ¶æ˜¯ä¸€ä¸ªç å…ƒ
çŽ°åœ¨å­—ç¬¦å˜å¤š, å…è®¸32ä½äºŒè¿›åˆ¶è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦, ä¹Ÿå°±æ˜¯äºŒä¸ªç å…ƒ
ä¸€ä¸ªå­—ç¬¦ç”±ä¸€ä¸ªè¿˜æ˜¯ä¸¤ä¸ªç å…ƒè¡¨ç¤º, éœ€è¦åˆ¤æ–­
str.length, å–çš„æ˜¯ç å…ƒçš„ä¸ªæ•°
xxx[i], ä¸‹æ ‡ä¹Ÿè¯´çš„æ˜¯ç å…ƒçš„ä¸‹æ ‡ */




// str.codePointAt(x) å¾—åˆ°ç ç‚¹çš„å€¼, è¿”å›žä¸€ä¸ªæ•°å­—(ç ç‚¹ä¸Žæ•°å­—ä¸€ä¸€å¯¹åº”, æ— é‡å¤)
console.log(
  'ðŸ˜‚'.codePointAt(0),
  'ðŸ˜‚'.codePointAt(0) > 0xffff, // å ç”¨ä¸¤ä¸ªç å…ƒ
  'æ˜¯'.codePointAt(0) > 0xffff, // å ç”¨ä¸€ä¸ªç å…ƒ
)


// æ–¹ä¾¿çœ‹, å’Œstrå€¼ä¸€æ ·
const str2 = 'å‰å¨ƒå¨ƒä¸æ˜¯ð ®·å¨ƒå¨ƒðŸ˜‚æ˜¯ä¸æ˜¯çœ¼èŠ±äº†'
// ä¼ å®žå‚è¿˜æ˜¯æŒ‰ç ç‚¹æ¥    å¨ƒå¨ƒðŸ˜‚   è¿˜æ˜¯(6, 9)
// ç ç‚¹å…¶å®žæ˜¯äººèƒ½çœ‹åˆ°çš„
// ä½†å®žé™…ä¸Šæˆªå–çš„æ—¶å€™æ˜¯æŒ‰ç å…ƒæ¥å–çš„, å…³é”®æ˜¯ç å…ƒæŒ‡é’ˆçš„ç§»åŠ¨è®¡ç®—
String.prototype.substringByPoint = function (pointStart, pointEnd) {
  let result = '' // æˆªå–çš„ç»“æžœ
  let pointIdx = 0 //  ç ç‚¹çš„æŒ‡é’ˆ
  let cellIdx = 0 //  ç å…ƒçš„æŒ‡é’ˆ
  console.log('this:', this)

  // åŒæŒ‡é’ˆä¸æ–­åœ°å‘å³ç§»åŠ¨æ¥è¿›è¡Œæˆªå–, ä½¿ç”¨å¾ªçŽ¯
  while (1) {
    // ä»€ä¹ˆæ—¶å€™ç»“æŸå¾ªçŽ¯?
    if (pointIdx >= pointEnd || cellIdx >= this.length) {
      break
    }

    // å‘å³ç§»åŠ¨æŒ‡é’ˆä¹‹å‰è¦åšçš„ä»»åŠ¡!!!
    // thisæŒ‡å‘è¦å¤„ç†çš„å­—ç¬¦ä¸²(è¿™é‡Œæ˜¯str2)
    // str.codePointAt(x) // å®žå‚æ˜¯æŒ‰ç å…ƒæŒ‡é’ˆæ¥è®¡ç®—çš„, è¿”å›žä¸€ä¸ªæ•°å­—(ç ç‚¹ä¸Žæ•°å­—ä¸€ä¸€å¯¹åº”, æ— é‡å¤)å¾—åˆ°ç ç‚¹çš„å€¼
    const pointNum = this.codePointAt(cellIdx)
    if (pointIdx >= pointStart) {
      // String.fromCodePoint(x) // å®žå‚ä¼ ç ç‚¹çš„å€¼(codePointAtæ–¹æ³•å¾—åˆ°çš„æ•°å­—), è¿”å›žå­—ç¬¦
      result += String.fromCodePoint(pointNum)
    }

    // å‘å³ç§»åŠ¨åŒæŒ‡é’ˆ
    pointIdx++
    // å‘å³ä¸€æ¬¡ç§»åŠ¨, å ä¸¤ä¸ªç å…ƒå°±ç§»åŠ¨ä¸¤ä½, å ä¸€ä¸ªç å…ƒå°±ç§»åŠ¨ä¸€ä½
    cellIdx += pointNum > 0xffff ? 2 : 1
  }
  return result
}

console.log(
  str2.substringByPoint(6, 9)
)